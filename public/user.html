<input type="file" accept="image/*" capture="camera" id="fotoKtp">
<button onclick="prosesData()">Upload & Ekstrak</button>

<script>
async function prosesData() {
  const file = document.getElementById('fotoKtp').files[0];
  const reader = new FileReader();
  
  reader.onloadend = async () => {
    // 1. Resize Image via Canvas (Penting agar CPU Worker aman)
    const img = new Image();
    img.src = reader.result;
    img.onload = async () => {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = 800; // Resize ke 800px saja
      canvas.height = (img.height / img.width) * 800;
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      
      const base64Clean = canvas.toDataURL('image/jpeg', 0.8).split(',')[1];

      // 2. Kirim ke Backend
      const res = await fetch('/api/user/upload', {
        method: 'POST',
        body: JSON.stringify({ imageBase64: base64Clean })
      });
      const hasil = await res.json();
      alert("Data Ekstrak: " + hasil.data.nama);
    };
  };
  reader.readAsDataURL(file);
}
</script>
